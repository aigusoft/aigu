# 测试策略

## 目标
- 以真实 Chrome/CDP 会话验证脚本的全部关键路径，不依赖 stub。
- 每次测试生成可追溯的会话目录，包含日志、报告与元数据。

## 目录结构
```
skills/WEB前端自动化调试.skills/
└── test/
    ├── cases/                # 可复用测试脚本
    ├── run_all.sh            # 统一驱动
    └── sessions/<timestamp>/
        ├── README.md
        ├── report.md
        ├── meta.json
        └── logs/<case>/
```
- `cases` 保持静态；`sessions` 按时间戳聚合所有产物。
- `logs/<case>/` 中保存 `case.log`、`stdout.txt`、`cdp_logs/` 等文件。

## 用例覆盖
| 脚本 | 功能 |
| --- | --- |
| `00_工具入口_帮助信息.sh` | 校验 `--help` 文案完整。|
| `01_工具入口_参数校验.sh` | 未知参数时返回退出码 22 并输出提示。|
| `02_执行js表达式_默认输出.sh` | 执行默认 JS，验证 `chrome.log`、`websocat.log` 与终端输出。|
| `03_执行js表达式_自定义输出.sh` | 传入自定义表达式并检查 console 输出透传。|
| `04_启动与端口准备_仅初始化.sh` | `--bootstrap-only` 输出包含 host/port/pid/log，验证脚本可复用/重启并提供手动收尾所需信息。|
| `05_手动会话_手动交互.sh` | 使用 bootstrap 信息 + curl + websocat 手动发送 `Runtime.evaluate`。|
| `06_启动与端口准备_复用与重启.sh` | 复用现有调试实例并验证 `--new-chrome` 强制重启能力。|
| `07_执行js表达式_DOM复用验证.sh` | 连续多次执行脚本复用同一浏览器，进行 DOM 操作并验证最终状态。|
| `08_执行js表达式_dom工具.sh` | 使用 DOM 工具脚本封装的命令创建/查询节点，验证输出。|

## 执行流程
1. `run_all.sh` 创建 `sessions/<timestamp>/logs/` 并逐个执行 `cases/*.sh`。
2. 每个用例获得 `SKILL_ROOT/SESSION_DIR/LOGS_DIR` 等环境变量，自行生成额外产物。
3. 脚本收集结果、耗时，写入 `report.md`（表格）与 `meta.json`（机器可读）。
4. README 记录复现方式与统计数据。

## 依赖管理
- 测试脚本使用 Bash + 常用 CLI（curl/jq/websocat/python），缺失依赖时会在脚本中提示安装。
- Chrome/WSL 网络策略由被测脚本负责，测试仅消费其输出。

## 扩展建议
- 根据新功能增加对应 `cases/*.sh`，并在 README/报告中更新覆盖表。
- 可在 CI 中运行 `run_all.sh` 并上传 `sessions/` 目录作为工件，以追踪问题。
