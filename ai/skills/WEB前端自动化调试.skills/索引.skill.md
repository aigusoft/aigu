## 技能概述
`WEB前端自动化调试.skills` 提供 `cdp_eval.sh` 及配套 skill，帮助智能体在 Linux/WSL 中快速启动 Chrome、复用远程调试端口、执行单次 JS 表达式或手动发送 CDP 命令。

## 前置依赖
- 系统已安装 Chrome/Chromium（Linux）或 Windows Chrome（WSL），允许打开远程调试端口。
- CLI 工具：`bash`, `python3`, `curl`, `jq`, `websocat`，执行 skill 前可用 `which <cmd>` 自检。
- 若在 WSL 中运行，需要具备创建/删除防火墙规则与 `netsh interface portproxy` 的权限。

## 快速导航
| 功能 | Skill 文件 | 内容摘要 |
| --- | --- | --- |
| 启动浏览器与端口准备 | `设计方案/02_启动与CDP流程.md` | 如何执行 `--bootstrap-only`、读取 `devtools_host`、复用或 `--new-chrome` 重启。 |
| 执行/自定义表达式 | `执行js表达式.skill.md` | 启动默认或自定义表达式、定位日志。 |
| 手动 CDP 会话 | `手动会话.skill.md` | 利用 bootstrap 信息 + curl/jq/websocat 发送 CDP 命令。 |
| DOM 操作工具 | (脚本) `tools/cdp_dom.sh` | 通过 create/set/query 子命令直接进行 DOM 操作。 |

> 若需架构、端口策略、测试设计等细节，请参考 `设计方案/` 目录下的文档。

## 常用命令
| 场景 | 命令 |
| --- | --- |
| 启动浏览器并获取 `devtools_host/devtools_port` | `./WEB前端自动化调试.skills/tools/cdp_eval.sh --bootstrap-only > session.env` |
| 执行默认表达式 | `./WEB前端自动化调试.skills/tools/cdp_eval.sh` |
| 执行自定义表达式并持久化日志 | `./WEB前端自动化调试.skills/tools/cdp_eval.sh --log-dir ./logs --expression '(() => console.log("custom"))()'` |
| 强制全新启动（清空旧实例） | `./WEB前端自动化调试.skills/tools/cdp_eval.sh --new-chrome --bootstrap-only` |
| 复用现有 Chrome 做手动会话 | `source session.env && ./WEB前端自动化调试.skills/tools/cdp_eval.sh --expression '<js>'` 或参考 `手动会话.skill.md` |
| DOM 工具创建/查询元素 | `./WEB前端自动化调试.skills/tools/cdp_dom.sh create --tag h1 --id demo --text 'Hi'` 等命令 |

## 调试提示
- `source session.env` 后可使用 `curl http://$devtools_host:$devtools_port/json` 查看 target 列表、定位 `webSocketDebuggerUrl`。
- `websocat -B 65536 $webSocketDebuggerUrl` 可直接交互，配合 `jq` 或 `cat` 注入 JSON 请求。
- 复用模式默认保留浏览器，若需干净环境请执行 `cdp_eval.sh --new-chrome --bootstrap-only` 并使用最新的 `session.env`。
