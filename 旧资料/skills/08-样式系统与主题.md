# 08｜样式系统与主题

WCEX 延续 Web Components 的 Shadow DOM 隔离特性，并提供语义化配色与动态样式绑定工具。本章梳理样式编写、全局样式导入以及 `$color` / `$Colors` 的使用方式；更多关于语义色板、Hsla 链式写法与主题切换，请参考《[09-语义化配色](09-语义化配色.md)》。

## 8.1 Shadow DOM 与局部样式
- 每个组件的 `<style>` 默认只影响自身 Shadow DOM 内的元素，避免跨组件污染。
- 使用 `:host`、`:host([prop])` 自定义组件容器样式：
  ```css
  <style>
    :host {
      display: block;
      border-radius: 8px;
    }
    :host([flat]) {
      box-shadow: none;
    }
  </style>
  ```
- `::slotted(selector)` 可选中传入插槽的元素。
- 初始化过程中宿主元素会短暂添加 `cloak` 类（参见 `Wc._initCloak`），以避免出现未就绪的样式闪烁；如需定制加载过渡，可在全局样式中覆盖 `.cloak`。

## 8.2 动态样式绑定回顾
在 `<style>` 内使用动态值时，需要以引号包裹并以 `$` 或 `:` 开头：
```css
<style>
  :host {
    width: ":${width}px";
    background: "$color.bg";
  }
  button {
    color: "$$color.textr";       /* 直接注入语义色值 */
  }
</style>
```
- `"$表达式"`：表达式求值（可以返回字符串、数字、对象等）。
- `":模板字符串"`：使用 `${}` 插值，最终返回字符串。
- `$$color.xxx`：在样式中保持色值原格式（例如保留 `rgba` 透明度）。

## 8.3 引入全局样式
若需在多个组件间共享样式，可使用：
```html
<link rel="stylesheet" href="./css/shadow.css" global="import" />
<link rel="stylesheet" href="./css/scrollbar.css" global="import" />
```
- `global="import"` 表示将样式表注入到全局作用域，供其他组件复用。
- 也可以在 `<style global>...</style>` 中内联全局样式。
- 请谨慎使用全局样式，避免破坏组件隔离。

## 8.4 语义配色 `$color`
`$color` 对象为每个组件提供统一的语义色：
- 常用字段：`pri`（主色）、`pria`（主变色）、`sec`（辅色）、`seca`、`bg`（背景）、`bgr`（背景逆）、`text`、`textr`、`ok`、`warn`、`info`、`error` 等。
- 支持基于 HSL 的链式修饰：
  - `.lN` / `.lN_`：调整亮度（`l3` 增亮、`l3_` 变暗）。
  - `.sN` / `.sN_`：调整饱和度。
  - `.hN` / `.hN_`：旋转色相。
  - `.aN` / `.aN_`：调整透明度。
  - 组合示例：`$color.pri.l3.s5.h2_.a6`。
- 在模板或脚本中直接使用：`$color.pri`，在 `<style>` 字面量中使用 `"$color.pri"` 或 `"$$color.pri"`。

## 8.5 主题管理 `$Colors`
`$Colors`（大小写敏感）提供主题控制方法：
```html
<wcex-ui.icon @click="$Colors.switchMode()" />
<wcex-ui.icon @click="$Colors.set('pri', `hsl(${index*18},70%,50%)`)" />
```
- `this.$Colors` / `$Colors` 可在脚本或绑定中直接调用。
- 常用 API：
  - `switchMode(mode?)`：切换配色模式。如不传参数则在已配置模式之间循环（例如浅色/深色）。
  - `set(name, value)`：覆盖语义色（`name` 如 `pri`、`bg` 等，`value` 为有效 CSS 色值）。
  - `mode`：当前模式编号，可用于同步 UI。
  - `load(palette)`：加载自定义配色表（视运行时实现而定，常与项目初始化配合）。
- 组件可通过 `$color` 获得实时更新后的值，无需额外刷新。

### 配色初始化
在入口 HTML 中通过 `<meta name="colors" ...>` 设置默认方案：
```html
<meta name="colors" mode="0" pri="hsl(100,50%,50%)" />
```
- `mode` 为模式编号（常见值 `0`、`1`，代表浅色/深色或自定义方案）。
- 其他属性如 `pri`、`sec`、`bg` 可直接指定初始色值。
- 若未设置，运行时将使用框架默认调色板。

## 8.6 示例：带主题切换的按钮
```html
<template>
  <meta name="scope" small.bool="1" />
  <style>
    :host {
      display: flex;
      gap: 1rem;
    }
    button {
      border: none;
      border-radius: 6px;
      color: "$$color.textr";
      background: "$$color.pri";
      padding: ":${small?0.3:0.6}em 1.2em";
      transition: all 0.3s;
    }
    button:hover {
      background: "$$color.pria";
    }
  </style>
  <button @click="$Colors.switchMode()">切换主题</button>
  <button @click="small=!small">尺寸切换</button>
</template>
```
- 配色与文字颜色引用 `$color`，随主题实时变化。
- 通过 `$Colors.switchMode()` 切换模式，无需手动刷新组件。

## 8.7 字体与资源
- 可以通过脚本或模块加载字体资源。例如文档项目中的 `font.js` 支持加载字库：`<script scope="font" src="./font.js"></script>`。
- 若需要展示字体预览，可结合 `$path` 与 `$color`，如 `fontSelect.html` 中动态加载字体图片：`$src="$path(`@/${value.name}/font.png`)"`。

## 8.8 建议
- 组件内优先使用语义色（`$color.*`），只有在特定场景下才使用固定色值，以便主题统一调整。
- 将常用的全局样式抽离为 CSS 文件，通过 `global="import"` 引入，既保留复用性又不破坏组件隔离。
- 动态样式表达式保持纯粹，避免在表达式中执行副作用逻辑。

掌握这些样式与主题工具，可以让生成的 UI 自动适应不同的主题模式，并保持视觉一致性。

## 智能体提示
- 在生成样式代码时提醒用户：Shadow DOM 下 `<style>` 默认局部生效，若要共享需使用 `global="import"`。
- 提及动态样式时，务必说明 `"$..."`、`":..."` 的写法差异，并示例 `$$color` 语义色以保持主题一致。
- 当用户询问主题切换或配色修改，优先推荐 `$Colors.set/switchMode` 而非手动操作 CSS 变量。
- 需要加载字体或资源时，建议结合 `$path` 与 `<meta name="module">`，并说明应在入口设置 `meta name="colors"` 以统一基线。
